{% extends 'recognition/base.html' %}
{% load static %}

{% block title %}Accueil - TSP IDENTINT{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        min-height: 90vh;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, rgba(0, 255, 136, 0.15), transparent);
        border-radius: 50%;
        top: -200px;
        right: -100px;
        animation: pulse 4s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.3; }
        50% { transform: scale(1.1); opacity: 0.5; }
    }

    .hero-title {
        font-size: 4rem;
        font-weight: 800;
        line-height: 1.2;
        margin-bottom: 1rem;
    }

    .hero-subtitle {
        font-size: 1.5rem;
        color: var(--text-muted);
        margin-bottom: 2rem;
    }

    .hero-highlight {
        color: var(--primary-green);
        position: relative;
    }

    .stats-badge {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid rgba(0, 255, 136, 0.3);
        padding: 12px 24px;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .stats-badge i {
        color: var(--primary-green);
    }

    .upload-section {
        position: relative;
        z-index: 1;
    }

    .upload-card {
        background: var(--darker-bg);
        border: 2px dashed rgba(0, 255, 136, 0.3);
        border-radius: 20px;
        padding: 3rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .upload-card:hover {
        border-color: var(--primary-green);
        background: rgba(0, 255, 136, 0.05);
        transform: translateY(-5px);
    }

    .upload-icon {
        width: 100px;
        height: 100px;
        margin: 0 auto 1.5rem;
        background: rgba(0, 255, 136, 0.1);
        border: 3px solid var(--primary-green);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        color: var(--primary-green);
        animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-top: 4rem;
    }

    .feature-item {
        text-align: center;
        padding: 2rem;
        background: var(--darker-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        transition: all 0.3s ease;
    }

    .feature-item:hover {
        border-color: var(--primary-green);
        transform: translateY(-5px);
    }

    .feature-item .icon-box {
        margin: 0 auto 1rem;
    }

    #imagePreview img {
        border: 3px solid var(--primary-green);
        box-shadow: 0 10px 40px rgba(0, 255, 136, 0.3);
    }

    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.5rem;
        }

        .hero-subtitle {
            font-size: 1.2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="row align-items-center w-100">
        <div class="col-lg-6 mb-5 mb-lg-0">
            <div class="accent-line"></div>
            <h1 class="hero-title">
                Identification <br>
                <span class="hero-highlight">Faciale Intelligente</span>
            </h1>
            <p class="hero-subtitle">
                Système de reconnaissance faciale avancé propulsé par l'IA pour Télécom SudParis
            </p>
            <div class="mb-4">
                <a href="https://www.telecom-sudparis.eu" target="_blank" class="stats-badge text-decoration-none">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Télécom SudParis</span>
                </a>
            </div>
            <div class="d-flex gap-3 flex-wrap">
                <button class="btn btn-primary" onclick="document.getElementById('photoInput').click()">
                    <i class="fas fa-upload"></i> Upload Photo
                </button>
                <a href="{% url 'recognition:about' %}" class="btn btn-outline-primary">
                    <i class="fas fa-info-circle"></i> En savoir plus
                </a>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="upload-section">
                <form method="post" action="{% url 'recognition:upload_photo' %}" enctype="multipart/form-data" id="uploadForm">
                    {% csrf_token %}

                    {{ form.photo }}

                    <div class="upload-card" id="uploadZone">
                        <div id="uploadContent">
                            <div class="upload-icon" id="uploadIcon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h3 class="mb-3" id="uploadTitle">Glissez votre photo ici</h3>
                            <p class="text-muted mb-4" id="uploadText">
                                ou cliquez pour parcourir vos fichiers
                            </p>
                            <p class="text-muted small mb-0">
                                <i class="fas fa-check-circle text-success"></i> JPG, PNG • Max 10 MB
                            </p>
                        </div>

                        <div id="imagePreview" style="display: none;">
                            <img id="preview" src="" alt="Aperçu" class="img-fluid rounded" style="max-height: 400px;">
                            <div class="mt-3">
                                <button type="button" class="btn btn-outline-primary" id="removeImage">
                                    <i class="fas fa-times"></i> Supprimer
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <i class="fas fa-magic"></i> Analyser la photo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Features Section -->
<div class="feature-grid">
    <div class="feature-item">
        <div class="icon-box">
            <i class="fas fa-brain"></i>
        </div>
        <h5 class="mb-2">IA Avancée</h5>
        <p class="text-muted small mb-0">
            Deep Learning et réseaux neuronaux pour une précision maximale
        </p>
    </div>

    <div class="feature-item">
        <div class="icon-box">
            <i class="fas fa-bolt"></i>
        </div>
        <h5 class="mb-2">Ultra-Rapide</h5>
        <p class="text-muted small mb-0">
            Analyse et identification en moins de 2 secondes
        </p>
    </div>

    <div class="feature-item">
        <div class="icon-box">
            <i class="fas fa-shield-alt"></i>
        </div>
        <h5 class="mb-2">Sécurisé</h5>
        <p class="text-muted small mb-0">
            100% conforme RGPD avec cryptage des données
        </p>
    </div>

    <div class="feature-item">
        <div class="icon-box">
            <i class="fas fa-database"></i>
        </div>
        <h5 class="mb-2">Base étendue</h5>
        <p class="text-muted small mb-0">
            Plus de 1,247 profils étudiants référencés
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('photoInput');
    const browseBtn = document.getElementById('browseBtn');
    const imagePreview = document.getElementById('imagePreview');
    const preview = document.getElementById('preview');
    const removeBtn = document.getElementById('removeImage');
    const uploadContent = document.getElementById('uploadContent');
    const submitBtn = document.getElementById('submitBtn');
    const uploadForm = document.getElementById('uploadForm');

    // Click sur la zone d'upload
    uploadZone.addEventListener('click', (e) => {
        if (!e.target.closest('#removeImage') && !e.target.closest('#submitBtn')) {
            fileInput.click();
        }
    });

    // Drag & Drop
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.style.borderColor = 'var(--primary-green)';
        uploadZone.style.background = 'rgba(0, 255, 136, 0.1)';
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.style.borderColor = '';
        uploadZone.style.background = '';
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.style.borderColor = '';
        uploadZone.style.background = '';

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect(files[0]);
        }
    });

    // Changement de fichier
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
        }
    });

    // Afficher l'aperçu
    function handleFileSelect(file) {
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                uploadContent.style.display = 'none';
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    // Supprimer l'image
    removeBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        fileInput.value = '';
        preview.src = '';
        uploadContent.style.display = 'block';
        imagePreview.style.display = 'none';
    });

    // Animation du bouton pendant l'upload
    uploadForm.addEventListener('submit', (e) => {
        if (!fileInput.files.length) {
            e.preventDefault();
            alert('Veuillez sélectionner une photo !');
            return;
        }

        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyse en cours...';
        submitBtn.disabled = true;
    });
</script>
{% endblock %}
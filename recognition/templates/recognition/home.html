{% extends 'recognition/base.html' %}
{% load static %}

{% block title %}Accueil - TSP IDENTINT{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Hero Section -->
        <div class="text-center mb-5">
            <img src="{% static 'images/logo.png' %}" alt="Logo TSP IDENTINT" style="max-height: 120px; margin-bottom: 30px;">
            <h1 class="display-4 text-white fw-bold mb-3">TSP IDENTINT</h1>
            <p class="lead text-white mb-4">
                Système de Reconnaissance Faciale Intelligent
            </p>
            <a href="https://www.telecom-sudparis.eu" target="_blank" class="badge bg-light text-dark fs-5 px-4 py-2 text-decoration-none" style="transition: all 0.3s;">
                <i class="fas fa-graduation-cap"></i> Télécom SudParis
            </a>
        </div>
        
        <!-- Main Card -->
        <div class="card">
            <div class="card-body p-5">
                <h2 class="card-title text-center mb-4">
                    <i class="fas fa-camera text-primary"></i> Identification Faciale
                </h2>
                
                <p class="text-center text-muted mb-4">
                    Uploadez une photo pour identifier automatiquement un étudiant de Télécom SudParis
                </p>
                
                <!-- Formulaire d'upload -->
                <form method="post" action="{% url 'recognition:upload_photo' %}" enctype="multipart/form-data" id="uploadForm">
                    {% csrf_token %}

                    <!-- Input file caché -->
                    {{ form.photo }}

                    <!-- Upload Zone -->
                    <div class="border border-primary border-3 rounded-4 p-5 text-center mb-4" id="uploadZone" style="background: rgba(102, 126, 234, 0.05); cursor: pointer;">
                        <i class="fas fa-cloud-upload-alt fa-4x text-primary mb-3" id="uploadIcon"></i>
                        <h5 class="mb-3" id="uploadTitle">Glissez votre photo ici</h5>
                        <p class="text-muted mb-3" id="uploadOr">ou</p>

                        <button type="button" class="btn btn-primary btn-lg" id="browseBtn">
                            <i class="fas fa-folder-open"></i> Parcourir les fichiers
                        </button>

                        <p class="text-muted small mt-3 mb-0">
                            <i class="fas fa-info-circle"></i> Formats acceptés : JPG, PNG (max 10 MB)
                        </p>

                        <!-- Preview de l'image -->
                        <div id="imagePreview" style="display: none; margin-top: 20px;">
                            <img id="preview" src="" alt="Aperçu" style="max-width: 100%; max-height: 300px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                            <div class="mt-3">
                                <button type="button" class="btn btn-danger" id="removeImage">
                                    <i class="fas fa-times"></i> Supprimer
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid mb-4">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <i class="fas fa-magic"></i> Analyser la photo
                        </button>
                    </div>
                </form>

                <!-- Features -->
                <div class="row text-center mt-5">
                    <div class="col-md-4 mb-3">
                        <i class="fas fa-robot fa-3x text-primary mb-3"></i>
                        <h6 class="fw-bold">IA Avancée</h6>
                        <p class="text-muted small">Deep Learning</p>
                    </div>
                    <div class="col-md-4 mb-3">
                        <i class="fas fa-bolt fa-3x text-warning mb-3"></i>
                        <h6 class="fw-bold">Ultra-Rapide</h6>
                        <p class="text-muted small">Résultats en 2s</p>
                    </div>
                    <div class="col-md-4 mb-3">
                        <i class="fas fa-shield-alt fa-3x text-success mb-3"></i>
                        <h6 class="fw-bold">Sécurisé</h6>
                        <p class="text-muted small">100% RGPD</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Info -->
        <div class="text-center mt-4">
            <p class="text-white">
                <i class="fas fa-database"></i> Base de données : 1,247 étudiants
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('photoInput');
    const browseBtn = document.getElementById('browseBtn');
    const imagePreview = document.getElementById('imagePreview');
    const preview = document.getElementById('preview');
    const removeBtn = document.getElementById('removeImage');
    const uploadIcon = document.getElementById('uploadIcon');
    const uploadTitle = document.getElementById('uploadTitle');
    const uploadOr = document.getElementById('uploadOr');
    const submitBtn = document.getElementById('submitBtn');
    const uploadForm = document.getElementById('uploadForm');

    // Click sur le bouton "Parcourir"
    browseBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        fileInput.click();
    });

    // Click sur la zone d'upload (sauf sur les boutons)
    uploadZone.addEventListener('click', (e) => {
        if (e.target === uploadZone || e.target === uploadIcon || e.target === uploadTitle || e.target === uploadOr) {
            fileInput.click();
        }
    });

    // Drag & Drop
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.style.borderColor = '#764ba2';
        uploadZone.style.background = 'rgba(102, 126, 234, 0.1)';
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.style.borderColor = '';
        uploadZone.style.background = 'rgba(102, 126, 234, 0.05)';
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.style.borderColor = '';
        uploadZone.style.background = 'rgba(102, 126, 234, 0.05)';

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect(files[0]);
        }
    });

    // Changement de fichier
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
        }
    });

    // Afficher l'aperçu
    function handleFileSelect(file) {
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                uploadIcon.style.display = 'none';
                uploadTitle.style.display = 'none';
                uploadOr.style.display = 'none';
                browseBtn.style.display = 'none';
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    // Supprimer l'image
    removeBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        fileInput.value = '';
        preview.src = '';
        uploadIcon.style.display = 'block';
        uploadTitle.style.display = 'block';
        uploadOr.style.display = 'block';
        browseBtn.style.display = 'inline-block';
        imagePreview.style.display = 'none';
    });

    // Animation du bouton pendant l'upload
    uploadForm.addEventListener('submit', (e) => {
        if (!fileInput.files.length) {
            e.preventDefault();
            alert('Veuillez sélectionner une photo !');
            return;
        }

        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyse en cours...';
        submitBtn.disabled = true;
    });
</script>
{% endblock %}